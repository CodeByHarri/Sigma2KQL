// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2022/08/05
// Level: high
// Description: Detects the removal of folders from the "ProtectedFolders" list of of exploit guard. This could indicate an attacker trying to launch an encryption process or trying to manipulate data inside of the protected folder
// Tags: attack.defense_evasion, attack.t1562.001
DeviceRegistryEvents
| where ActionType =~ "DeleteValue" and RegistryKey contains "SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\ProtectedFolders"