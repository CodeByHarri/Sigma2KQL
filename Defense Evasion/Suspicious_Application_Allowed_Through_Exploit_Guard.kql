// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2022/08/05
// Level: high
// Description: Detects applications being added to the "allowed applications" list of exploit guard in order to bypass controlled folder settings
// Tags: attack.defense_evasion, attack.t1562.001
DeviceRegistryEvents
| where (ActionType =~ "RegistryValueSet" and RegistryKey contains "SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\AllowedApplications") and (RegistryKey contains "\\Users\\Public" or RegistryKey contains "\\AppData\\Local\\Temp" or RegistryKey contains "\\Desktop" or RegistryKey contains "\\PerfLogs" or RegistryKey contains "\\Windows\\Temp")