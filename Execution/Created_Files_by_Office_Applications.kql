// Author: Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)
// Date: 2021/08/23
// Level: high
// Description: This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice.
// Tags: attack.t1204.002, attack.execution
DeviceFileEvents
| where ((InitiatingProcessFolderPath endswith "\\winword.exe" or InitiatingProcessFolderPath endswith "\\excel.exe" or InitiatingProcessFolderPath endswith "\\powerpnt.exe") and (FolderPath endswith ".exe" or FolderPath endswith ".dll" or FolderPath endswith ".ocx" or FolderPath endswith ".com" or FolderPath endswith ".ps1" or FolderPath endswith ".vbs" or FolderPath endswith ".sys" or FolderPath endswith ".bat" or FolderPath endswith ".scr" or FolderPath endswith ".proj")) and (not(((FolderPath contains "\\AppData\\Local\\assembly\\tmp\\" and FolderPath endswith ".dll") or (InitiatingProcessFolderPath endswith "\\winword.exe" and FolderPath contains "\\AppData\\Local\\Temp\\webexdelta\\" and (FolderPath endswith ".dll" or FolderPath endswith ".exe")) or ((FolderPath contains "C:\\Users\\" and FolderPath contains "\\AppData\\Local\\Microsoft\\Office\\" and FolderPath contains "\\WebServiceCache\\AllUsers") and FolderPath endswith ".com"))))