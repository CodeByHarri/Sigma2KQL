// Author: EagleEye Team, Florian Roth (Nextron Systems), NVISO
// Date: 2020/05/13
// Level: high
// Description: Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048
// Tags: attack.persistence, attack.execution, attack.defense_evasion, attack.t1112
DeviceRegistryEvents
| where (RegistryValueData contains ".dll" or RegistryValueData contains ".exe" or RegistryValueData contains ".bat" or RegistryValueData contains ".com" or RegistryValueData contains "C:") and ActionType =~ "RegistryValueSet" and RegistryKey startswith "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Ports"