// Author: Florian Roth (Nextron Systems)
// Date: 2022/02/11
// Level: high
// Description: Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools
// Tags: attack.execution, attack.t1059
DeviceProcessEvents
| where (ProcessCommandLine contains "inject.ps1" or ProcessCommandLine contains "Invoke-CVE" or ProcessCommandLine contains "pupy.ps1" or ProcessCommandLine contains "payload.ps1" or ProcessCommandLine contains "beacon.ps1" or ProcessCommandLine contains "PowerView.ps1" or ProcessCommandLine contains "bypass.ps1" or ProcessCommandLine contains "obfuscated.ps1" or ProcessCommandLine contains "obfusc.ps1" or ProcessCommandLine contains "obfus.ps1" or ProcessCommandLine contains "obfs.ps1" or ProcessCommandLine contains "evil.ps1" or ProcessCommandLine contains "MiniDogz.ps1" or ProcessCommandLine contains "_enc.ps1" or ProcessCommandLine contains "\\shell.ps1" or ProcessCommandLine contains "\\rshell.ps1" or ProcessCommandLine contains "revshell.ps1" or ProcessCommandLine contains "\\av.ps1" or ProcessCommandLine contains "\\av_test.ps1" or ProcessCommandLine contains "adrecon.ps1" or ProcessCommandLine contains "mimikatz.ps1" or ProcessCommandLine contains "\\PowerUp_" or ProcessCommandLine contains "powerup.ps1" or ProcessCommandLine contains "\\Temp\\a.ps1" or ProcessCommandLine contains "\\Temp\\p.ps1" or ProcessCommandLine contains "\\Temp\\1.ps1" or ProcessCommandLine contains "Hound.ps1" or ProcessCommandLine contains "encode.ps1" or ProcessCommandLine contains "powercat.ps1") or ((FolderPath contains "\\CVE-202" or FolderPath contains "\\CVE202") or (FolderPath endswith "\\poc.exe" or FolderPath endswith "\\artifact.exe" or FolderPath endswith "\\artifact64.exe" or FolderPath endswith "\\artifact_protected.exe" or FolderPath endswith "\\artifact32.exe" or FolderPath endswith "\\artifact32big.exe" or FolderPath endswith "obfuscated.exe" or FolderPath endswith "obfusc.exe" or FolderPath endswith "\\meterpreter"))