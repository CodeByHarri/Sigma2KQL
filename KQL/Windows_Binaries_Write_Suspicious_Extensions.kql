// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2022/08/12
// Level: high
// Description: Detects Windows executables that writes files with suspicious extensions
// Tags: 
DeviceFileEvents
| where ((InitiatingProcessFolderPath endswith "\\smss.exe" or InitiatingProcessFolderPath endswith "\\RuntimeBroker.exe" or InitiatingProcessFolderPath endswith "\\sihost.exe" or InitiatingProcessFolderPath endswith "\\lsass.exe" or InitiatingProcessFolderPath endswith "\\csrss.exe" or InitiatingProcessFolderPath endswith "\\winlogon.exe" or InitiatingProcessFolderPath endswith "\\wininit.exe") and (FolderPath endswith ".bat" or FolderPath endswith ".vbe" or FolderPath endswith ".txt" or FolderPath endswith ".vbs" or FolderPath endswith ".exe" or FolderPath endswith ".ps1" or FolderPath endswith ".hta" or FolderPath endswith ".iso" or FolderPath endswith ".dll")) or ((InitiatingProcessFolderPath endswith "\\rundll32.exe" or InitiatingProcessFolderPath endswith "\\svchost.exe" or InitiatingProcessFolderPath endswith "\\dllhost.exe") and (FolderPath endswith ".bat" or FolderPath endswith ".vbe" or FolderPath endswith ".vbs" or FolderPath endswith ".ps1" or FolderPath endswith ".hta" or FolderPath endswith ".iso"))